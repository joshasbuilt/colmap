# Bluff Revit Add-in

A Revit add-in that places sphere family instances at XYZ coordinates from cone_data.json files generated by the floor plan viewer.

## Project Structure

```
Bluff/
├── Bluff.sln                    # Visual Studio solution file
├── Bluff.addin                  # Revit add-in manifest
├── cone_data.json               # Camera position data (DXF coordinates)
├── README.md                    # This file
└── Source/
    └── Bluff/
        ├── Bluff.csproj         # Project file
        ├── BluffCommand.cs      # Main command class
        └── Properties/
            └── AssemblyInfo.cs  # Assembly information
```

## GUIDs Used

- **Project GUID**: `F7F00968-44DF-4C78-AD20-8F83C91B10A5`
- **Add-in GUID**: `5BA86B1B-D589-45D8-ADC6-01F9BC851D57`

## Features

- **Reads cone_data.json**: Automatically loads camera position data from JSON file
- **Coordinate Conversion**: Converts DXF coordinates (meters) to Revit XYZ (feet)
- **Family Placement**: Places sphere family instances at each camera position
- **Smart Family Detection**: Automatically finds sphere families in the project
- **Error Handling**: Comprehensive error handling with user feedback
- **Transaction Management**: Proper Revit transaction handling

## Building

To build the project:

```bash
dotnet build Source\Bluff\Bluff.csproj -c Debug
```

## Installation

1. **Copy files to Revit add-ins directory**:
   - Copy `Bluff.addin` to: `%APPDATA%\Autodesk\Revit\Addins\2022\`
   - Copy `Bluff.dll` (from `Source\Bluff\bin\Debug\`) to the same directory
   - Copy `cone_data.json` to the same directory

2. **Load a sphere family** in your Revit project:
   - Load a sphere family (e.g., `ASB_Anno_ClashMark3D.rfa`)
   - Or any family with "Sphere", "Ball", "Marker", or "Point" in the name

3. **Restart Revit**

4. **Run the command**:
   - Go to Add-Ins tab
   - Click "Bluff" button
   - The add-in will place sphere instances at all camera positions

## Usage

1. **Prepare your data**:
   - Export camera positions from the floor plan viewer as GeoJSON
   - Convert GeoJSON to cone_data.json using the converter script
   - Place cone_data.json in the add-ins directory

2. **Load sphere family**:
   - Load any sphere family into your Revit project
   - The add-in will automatically detect it

3. **Run the command**:
   - Click the "Bluff" button in the Add-Ins tab
   - The add-in will place spheres at all camera positions

## Coordinate System

- **Input**: DXF coordinates in meters (from cone_data.json)
- **Output**: Revit XYZ coordinates in feet
- **Conversion**: 1 meter = 3.28084 feet

## Data Format

The add-in expects `cone_data.json` with this structure:

```json
{
  "export_info": {
    "timestamp": "2025-10-16T...",
    "total_cones": 189,
    "base_point_northing": 808226.1590,
    "base_point_easting": 397922.9125,
    "base_point_elevation": 13.0000
  },
  "cones": [
    {
      "cone_id": 1,
      "dxf_position": {
        "x": -5.85,
        "y": -10.09,
        "z": -12.61
      },
      "frame_number": 191,
      "image_path": "panoramas/frame_0191.jpg"
    }
  ]
}
```

## Error Handling

The add-in provides detailed error messages for:
- Missing cone_data.json file
- Invalid JSON format
- No sphere family found in project
- Family symbol activation failures
- Individual instance placement failures

## Requirements

- .NET Framework 4.8
- Revit 2022 API
- System.Web.Extensions (for JSON parsing)
- A sphere family loaded in the Revit project

## Troubleshooting

1. **"No cone data found"**: Ensure cone_data.json is in the add-ins directory
2. **"Sphere family not found"**: Load a sphere family into the project
3. **"Family not found"**: The add-in looks for families with names containing: "ASB_Anno_ClashMark3D", "Sphere", "Ball", "Marker", or "Point"

## Development

To extend the add-in:
- Modify `BluffCommand.cs` for new functionality
- Add new data classes for different JSON formats
- Update the family detection logic in `FindSphereFamily()`
- Add new coordinate conversion methods if needed
